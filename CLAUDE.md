# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Project Overview

Radvent is a Qiita-style Advent Calendar web application (Japanese-focused). Users can create events, publish markdown articles on specific calendar dates, and interact via likes and comments. Built with Ruby on Rails 7.0 and Webpacker.

## Common Commands

### Setup
```bash
bundle install
yarn install
bundle exec rake radvent:generate_default_settings  # generates config files in config/settings/
bundle exec rake db:create db:migrate
```

### Running the App
```bash
bundle exec rails s
```

### Testing
```bash
bundle exec rspec spec                         # run all tests
bundle exec rspec spec/models/                 # run model specs
bundle exec rspec spec/controllers/            # run controller specs
bundle exec rspec spec/models/user_spec.rb     # run a single spec file
bundle exec rspec spec/models/user_spec.rb:42  # run a specific test by line number
```

Coverage output goes to `coverage/` (HTML and LCOV formats).

### Asset Compilation
```bash
bundle exec rake assets:precompile
```

## Architecture

### Tech Stack
- **Backend**: Ruby (>= 3.0) / Rails 7.0, Puma, Devise (auth)
- **Frontend**: Webpacker 5, HAML templates, SCSS, Bootstrap 5 (mdb-ui-kit), jQuery
- **Markdown**: Marked.js with highlight.js for syntax highlighting
- **File uploads**: CarrierWave
- **Database**: SQLite3 (dev default), MySQL 5.7+, or PostgreSQL (configurable via env vars in `config/database.yml`)

### Key Models and Relationships
- `User` — Devise-based auth, has admin role, has many items/likes/comments
- `Event` — Advent calendar event with start/end dates and entry limits
- `Item` — Article with markdown body, belongs to user and event
- `AdventCalendarItem` — Maps an item to a specific day in the calendar
- `Like` / `Comment` — User interactions on items
- `Attachment` — File uploads via CarrierWave

### Routing
Events use a name-based show route (`/events/:name`) rather than ID-based. Items have a nested `likes` resource and a `preview` member route. Root points to `welcome#index`.

### Configuration
- Timezone: Tokyo (`config.time_zone = 'Tokyo'`)
- Default locale: Japanese (`:ja`), with English support via `http_accept_language` gem
- App settings generated by `rake radvent:generate_default_settings` into `config/settings/`

## Code Style
- Ruby formatter: rufo with single quotes (`.rufo` config)
- Views use HAML (not ERB)
- Generator config: RSpec with FactoryBot, controller specs enabled, view/helper/routing specs disabled

## Docker
- `docker-compose.yml` at root runs PostgreSQL + Radvent
- `.devcontainer/` provides VS Code dev container setup with Ruby 3.1 and PostgreSQL

## CI
GitHub Actions matrix tests against Ruby 3.0 & 3.1 with SQLite3, MySQL, and PostgreSQL.
