{"version":3,"file":"js/items.js","mappings":";;;;;;;;;;;;;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAAA;AAAA;AAEA;AACA;AACA;AACA;AACA;AAAA;AAAA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAAA;AAAA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAGA;AACA;AACA;AAEA;AAEA;AACA;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AACA;AAEA;AACA;AACA;AACA;AAGA;AACA;AACA;AACA;AACA;AACA;AACA","sources":["webpack://radvent/./app/javascript/packs/items.js"],"sourcesContent":["/*\n * decaffeinate suggestions:\n * DS102: Remove unnecessary code created because of implicit returns\n * DS208: Avoid top-level this\n * Full docs: https://github.com/decaffeinate/decaffeinate/blob/master/docs/suggestions.md\n */\n// Place all the behaviors and hooks related to the matching controller here.\n// All this logic will automatically be available in application.js.\n// You can use CoffeeScript in this file: http://coffeescript.org/\nimport marked from 'marked'\nimport * as mdb from 'mdb-ui-kit';\nwindow.relative_url_root_path = '/';\n\nexport const setRootPath = path => window.relative_url_root_path = path;\n\nconst parseText = function(text) {\n  // parsing markdown to html\n  $('#item-preview-content').html(marked(text));\n  // highlighting\n  return $('#item-preview-content').find('pre code').each((i, block) => hljs.highlightBlock(block));\n};\n\nconst checkTextChange = function() {\n  let v;\n  let old = (v = $('#item-text').val());\n  return function() {\n    v = $('#item-text').val();\n    if (old !== v) {\n      old = v;\n      return parseText(v);\n    }\n  };\n};\n\nconst attachmentImageInputChange = function(e) {\n  e.preventDefault;\n  if (!this.files.length) { return; }\n  const form_data = new FormData;\n  form_data.append($(this).attr('name'), $(this).prop('files')[0]);\n  form_data.append($('#attachment-advent-calendar-id').attr('name'),\n    $('#attachment-advent-calendar-id').val());\n  return uploadFile(form_data);\n};\n\nconst uploadFile = function(form_data) {\n  return $.ajax(window.relative_url_root_path + 'attachments', {\n    type: 'POST',\n    dataType: 'json',\n    data: form_data,\n    processData: false,\n    contentType: false,\n    success(data) {\n      $(this).val('');\n      $('#item-text').focus();\n      const sentence = $('#item-text').val();\n      const len      = sentence.length;\n      let pos      = $('#item-text').get(0).selectionStart;\n      if (pos === undefined) {\n          pos = 0;\n        }\n    \n      const before   = sentence.substr(0, pos);\n      const after    = sentence.substr(pos, len);\n      $('#item-text').val(before +\n        `\\r\\n![${data.image_name}](${data.image_url})` + after\n      );\n      return parseText($('#item-text').val());\n    }\n  }\n  );\n};\n\n$(document).on('paste', '#item-text', function(event) {\n  const {\n    items\n  } = event.originalEvent.clipboardData;\n  let i = 0;\n  while (i < items.length) {\n    const item = items[i];\n    if (item.type.indexOf('image') !== -1) {\n      // 画像のみサーバへ送信する\n      const file = item.getAsFile();\n      const form_data = new FormData;\n      form_data.append($('#attachment-image-select').attr('name'), file);\n      form_data.append($('#attachment-advent-calendar-id').attr('name'),\n        $('#attachment-advent-calendar-id').val());\n      uploadFile(form_data);\n    }\n    i++;\n  }\n});\n\nconst ready = function() {\n  const parseBody = function() {\n    $('#item-show').html(marked(text));\n    $('#item-show').find('pre code').each((i, block) => hljs.highlightBlock(block));\n    return $('.comment-content').each(function(i, block) {\n      const comment = $(block).text();\n      return $(block).html(marked(comment));\n    });\n  };\n  if ($('#item-show')[0]) { parseBody(); }\n  if ($('#item-text').val()) { return parseText($('#item-text').val()); }\n};\n\n$(document).ready(ready);\n$(document).on('turbolinks:render', ready);\n$(document).on('keyup', '#item-text', checkTextChange());\n$(document).on('change', '#attachment-image-select', attachmentImageInputChange);\n\n\nvar setPopOver = function() {\n  var popoverTriggerList = $('[data-mdb-toggle=\"popover\"]');\n  var popoverList = popoverTriggerList.each(function (i, popoverTriggerEl) {\n    return new mdb.Popover(popoverTriggerEl);\n  });\n};\n$(document).on('turbolinks:load', setPopOver);"],"names":[],"sourceRoot":""}